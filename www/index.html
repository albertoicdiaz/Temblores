<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">
  
  <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
  <!--<script src="js/jquery-1.10.2.js"></script>-->
  
  <script src="js/capturado.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  <script type="text/javascript" src="js/Moment.js"></script>

  <title>Consulta de Temblores de USGS</title>

  <!-- Font Awesome Icons -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,700" rel="stylesheet">
  <link href='https://fonts.googleapis.com/css?family=Merriweather:400,300,300italic,400italic,700,700italic' rel='stylesheet' type='text/css'>

  <!-- Plugin CSS -->
  <link href="vendor/magnific-popup/magnific-popup.css" rel="stylesheet">

  <!-- Theme CSS - Includes Bootstrap -->
  <link href="css/creative.min.css" rel="stylesheet">
  <style>
      table, td {
        border: 1px solid black;
      }
      </style>
</head>

<body id="page-top">

  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-light fixed-top py-3" id="mainNav">
    <div class="container">
      
      <img src="img/Logo-unab-nuevo-2018.png" alt="Logo Unab" style="height: 100px ; width: 120px;">
    </div>
  </nav>

  <!-- Masthead -->
  <header class="masthead">
    <div class="container h-100">
        <div class="row h-100 align-items-center justify-content-center text-center">
          <div class="col-lg-10 align-self-end">
            <h1 class="text-uppercase text-white font-weight-bold">Consulta de Temblores de USGS</h1>
            <hr class="divider my-4">
          </div>
          <div class="col-lg-8 align-self-baseline">
            <form>
              <div class="form-group" action="" method="get">
                <div class="form-group row">
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Fecha de Inicio</label>
                  <div class="col-sm-10">
                    <input type="date" class="form-control" name="starttime" id="starttime" value="2019-05-01">
                  </div>
                </div>
                <div class="form-group row">                 
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Latitud Mínima</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" step=0.1 name="minlatitude" id="minlatitude" value="-55.8">
                  </div>
                </div>
                <div class="form-group row">     
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Latitud Máxima</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" step=0.1 name="maxlatitude" id="maxlatitude" value="-17.4">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Longitud Mínima</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" step=0.1 name="minlongitude" id="minlongitude" value="-100">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Longitud Máxima</label>
                  <div class="col-sm-10">
                    <input type="number" class="form-control" step=0.1 name="maxlongitude" id="maxlongitude" value="-65.8">
                  </div>
                </div>
                <div class="form-group row">
                  <label class="col-sm-2 col-form-label" style="color:#f4623a">Magnitud Mínima</label>
                  <div class="col-sm-10">
                   <input type="number" class="form-control" step=0.1 name="minmagnitude" id="minmagnitude" value="4">
                  </div>
                </div>
              </div>        
            </form>     
            <!-- <a class="btn btn-primary btn-xl js-scroll-trigger" onclick="cons();" href="#about">Consultar</a> -->
            <button type="submit" class="btn btn-primary btn-xl js-scroll-trigger" onclick="cons();">Consultar</button>
            <table id="myTable" style="margin-right: 0px;padding-right: 10px;margin-top: 20px;">
              <!-- <tr id="contenido" style="color: orangered;">
                  <td>Tiempo</td>
                  <td>Latitud</td>
                  <td>Longitud</td>
                  <td>Mag</td>
                </tr> -->
              </table>
            <!-- <div id="container">
              <div id="out"></div>
            </div> -->
          </div>
          
        </div>  
      </div>
  </header>

</body>


<script>

    var time=[];
    var latitude=[];
    var longitude = [];
    var magnitude = [];
    var finaldate = [];
    var t=[];
    var minutes =[];
    var hour =[];
    var starttime = null;
    var minlatitude = null;
    var maxlatitude = null;
    var minlongitude = null;
    var maxlongitude = null;
    var minmagnitude = null;
    var url = null;
    var firsturl = "https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson";
    var finalurl = null;
    var estado=1;

        //submit
        function cons(){
            // return timeStampCon;
            $("#myTable").empty();
            starttime = document.getElementById("starttime").value;
            minlatitude = document.getElementById("minlatitude").value;
            maxlatitude = document.getElementById("maxlatitude").value;
            minlongitude = document.getElementById("minlongitude").value;
            maxlongitude = document.getElementById("maxlongitude").value;
            minmagnitude = document.getElementById("minmagnitude").value;
            var value1=$.trim($("#starttime").val());
            var value2=$.trim($("#minlatitude").val());
            var value3=$.trim($("#maxlatitude").val());
            var value4=$.trim($("#minlongitude").val());
            var value5=$.trim($("#maxlongitude").val());
            var value6=$.trim($("#minmagnitude").val());


            if(value1.length==0 || value2.length==0 || value3.length==0 || value4.length==0 || value5.length==0 || value6.length==0 )
            {
                alert("Ingrese todos los valores");
            }else{
            url="&starttime="+starttime+"&minlatitude="+minlatitude+"&maxlatitude="+maxlatitude+"&minlongitude="+minlongitude+"&maxlongitude="+maxlongitude+"&minmagnitude="+minmagnitude;
            finalurl=firsturl+url;
            alert(finalurl);
        //    finalurl = "https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=2019-05-01&minlatitude=-55.8&maxlatitude=-17.4&minlongitude=-100&maxlongitude=-65.8&minmagnitude=4";
            data = JSON.parse(httpGet(finalurl));
            if (data.features){
                for(i = 0; i < data.features.length; i ++){
                  // console.log(data['features'][i]['properties']['time'], data['features'][i]['geometry']['coordinates']['0'], data['features'][i]['geometry']['coordinates']['1'], data['features'][i]['properties']['mag']);
                  time[i]=(data['features'][i]['properties']['time']); 
                  latitude[i]=(data['features'][i]['geometry']['coordinates']['0']);
                  longitude[i]=(data['features'][i]['geometry']['coordinates']['1']); 
                  magnitude[i]=(data['features'][i]['properties']['mag']);
                  t[i]=new Date(time[i]);
                  if (t[i].getHours()<=9){
                    hour[i]="0"+t[i].getHours();
                  }
                  if (t[i].getMinutes()<=9){
                    minutes[i]="0"+t[i].getMinutes();
                  }
                  if (t[i].getHours()>=10){
                    hour[i]=t[i].getHours();
                  }
                  if (t[i].getMinutes()>=10){
                    minutes[i]=t[i].getMinutes();
                  }
                  // finaldate[i] = t[i].getDate() + '/' + (t[i].getMonth()+1) + '/' + t[i].getFullYear() + " " + t[i].getHours() + ':' + t[i].getMinutes();
                  finaldate[i] = t[i].getDate() + '/' + (t[i].getMonth()+1) + '/' + t[i].getFullYear() + " " + hour[i] + ':' + minutes[i];
                  // finaldate[i] = ('0' + t[i].getHours()).slice(-2) + ':' + ('0' + t[i].getMinutes()).slice(-2) + ' (Hora Chile) ' + ('0' + t[i].getDay()).slice(-2)+ '/' + ('0' + t[i].getMonth()).slice(-2)+ '/' + ('0' + t[i].getFullYear()).slice(-2);
                  // finaldate=a.format("dd.mm.yyyy hh:MM:ss");
                }
                // alert (finaldate);
                //  alert(latitude.length);
                $('#myTable').append(`
                                      <tr id="contenido" style="color: orangered;">
                                      <td>Tiempo</td>
                                      <td>Latitud</td>
                                      <td>Longitud</td>
                                      <td>Mag</td>
                                      </tr>
                          `);
                for (i=0;i<longitude.length;i++){

                  $('#myTable').append(`
                                  <tr id="cache" style="color:orangered;">
                                      <td>${finaldate[i]}</td>
                                      <td>${latitude[i]}</td>
                                      <td>${longitude[i]}</td>
                                      <td>${magnitude[i]}</td>
                                  </tr>
                          `);
                }
              }
              estado=estado+1;
            
            // alert(time + latitude + longitude + magnitude);
            }
        };
        function httpGet(theUrl)
        {
            var xmlHttp = new XMLHttpRequest();
            xmlHttp.open( "GET", theUrl, false ); 
            xmlHttp.send( null );
            return xmlHttp.responseText;
        };
        // function timeConverter(UNIX_timestamp){
        //   var a = new Date(UNIX_timestamp * 1000);
        //   var months = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
        //   var year = a.getFullYear();
        //   var month = months[a.getMonth()];
        //   var date = a.getDate();
        //   var hour = a.getHours();
        //   var min = a.getMinutes();
        //   var sec = a.getSeconds();
        //   var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec ;
        //   return time;
        // };

</script>
</html>